<mat-card class="mat-elevation-z0 filter-card with-create grid gap-x-16 bg-grey mb-16 border"
  [ngClass]="hasButton ? 'col-md-3':'col-sm-1 no-button'">

  <div class="col-span-md-2">
    <div class="filter-search">
      <section class="filter-wrapper">
        <div class="section-box mb-xs-16 mb-sm-0" *ngIf="!hide.includes('dateRange')">
          <mat-form-field appearance="outline" (click)="picker.open()">
            <mat-date-range-input [max]="maxDate" [rangePicker]="picker">
              <input readonly matStartDate placeholder="Start date" [formControl]="start_date">
              <input readonly matEndDate placeholder="End date" [formControl]="end_date"
                (dateChange)="onDateRageChange($event.value)">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker">
              <mat-icon matDatepickerToggleIcon>date_range</mat-icon>
            </mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
        </div>
        <div class="section-box trigger-box mb-sm-0" *ngIf="!hide.includes('filter')">
          <button mat-stroked-button [matMenuTriggerFor]="menu" #filter="matMenuTrigger"
            class="bg-white rounded-md py-2" (click)="filterClick()">
            <mat-icon [matBadge]="filterSet.size ? filterSet.size : null" svgIcon="filter" matPrefix
              class="filter-icon">
            </mat-icon>
            <span class="px-8">ស្រង់តាម</span>
            <mat-icon matSuffix>expand_more</mat-icon>
          </button>
          <mat-menu #menu class="menu-filter-panel">
            <div class="menu-filter-header">
              <b>ស្រង់តាម</b>
              <span *ngIf="filterSet.size" (click)="reset(); $event.stopPropagation()"
                class="menu-filter-panel__clear">ដកចេញទាំងអស់</span>
            </div>
            <div class="expansion-panel" (click)="$event.stopPropagation()" (keyup)="null">
              <mat-accordion [togglePosition]="'before'" [multi]="false">
                <ng-container *ngFor="let child of filters; let i = index">
                  <mat-expansion-panel (closed)="onCollapse()" class="mat-elevation-z0" *ngIf="child.use"
                    [expanded]="useFilters.length === 1">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        {{child.title | titlecase}}
                        <div [class.hightlight]="filterSet.has(child.paramKey)"></div>
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div>
                      <ng-container *ngIf="child.dep">
                        <mat-form-field appearance="outline">
                          <mat-icon [svgIcon]="child.svgIcon" matPrefix class="filter-icon">
                            {{getFilterByKey(child.dep).matIcon}}</mat-icon>
                          <mat-select [placeholder]="'choose ' + getFilterByKey(child.dep).labelFunc | lowercase "
                            [(value)]="getFilterByKey(child.dep).selectedValue"
                            (selectionChange)="onFilter(getFilterByKey(child.dep), $event.value);" #select>
                            <mat-select-trigger>
                              <span>{{getFilterByKey(child.dep)?.selectedValue?.label}}</span>
                            </mat-select-trigger>
                            <mat-option *ngFor="let item of getFilterByKey(child.dep).data" [value]="item">
                              {{item?.label}}
                            </mat-option>
                          </mat-select>
                          <mat-icon matSuffix>expand_more</mat-icon>
                        </mat-form-field>
                      </ng-container>
                      <ng-container *ngIf="child.isMultiple; else notMutiple">
                        <app-selection-filter (queryEvent)="searchSubject($event)"></app-selection-filter>
                        <mat-chip-list style="height: 48px;">
                          <mat-chip *ngFor="let selectedItem of selectedSubjects"
                            (removed)="remove(selectedItem, child.paramKey)">
                            {{selectedItem.label}}
                            <button matChipRemove>
                              <mat-icon>cancel</mat-icon>
                            </button>
                          </mat-chip>
                        </mat-chip-list>
                        <mat-selection-list #subjects (selectionChange)="onSelectionChanges($event,child.paramKey)">
                          <cdk-virtual-scroll-viewport #scroller [itemSize]="48" class="option-container"
                            [minBufferPx]="240" [maxBufferPx]="240">
                            <div *cdkVirtualFor="let s of child.data">
                              <mat-list-option color="primary" checkboxPosition="before" [value]="s">{{ s.label }}
                              </mat-list-option>
                            </div>
                          </cdk-virtual-scroll-viewport>
                        </mat-selection-list>
                      </ng-container>
                      <ng-template #notMutiple>
                        <app-selection-filter *ngIf="child.hasSearch" (queryEvent)="onSearch($event, child.paramKey)">
                        </app-selection-filter>
                        <div class="custom-radio-filter">
                          <mat-radio-group *ngIf="child.data.length > 0" [(ngModel)]="child.selectedValue"
                            class="custom-radio-group" (change)="onFilter(child, $event.value)">
                            <mat-radio-button matRipple [matRippleColor]="'#0000001a'" class="custom-radio-button "
                              [value]="s" *ngFor="let s of child.data">{{ s.label }}</mat-radio-button>
                          </mat-radio-group>
                          <span class="no-data" *ngIf="child.data.length < 1">No Data</span>
                        </div>
                      </ng-template>
                    </div>
                  </mat-expansion-panel>
                </ng-container>
              </mat-accordion>
            </div>
          </mat-menu>
        </div>
        <div class="section-box search-box mb-sm-0" *ngIf="!hide.includes('search')">
          <mat-icon svgIcon="search"></mat-icon>
          <input matInput #searchQuery (keyup)="search(searchQuery.value)" placeholder="ស្វែងរក...">
          <button *ngIf="searchQuery.value" mat-icon-button matSuffix
            (click)="searchQuery.value = ''; clear(); $event.stopPropagation()">
            <mat-icon>clear</mat-icon>
          </button>
        </div>
        <div class="section-box mb-xs-16 mb-sm-0" *ngIf="!hide.includes('date')">
          <mat-form-field appearance="outline" (click)="picker.open()">
            <input matInput [matDatepicker]="picker" readonly [formControl]="dateNow"
              (dateChange)="onDateChange($event.target.value)" (click)="picker.open()">
            <mat-datepicker-toggle matPrefix>
              <mat-icon matDatepickerToggleIcon>date_range</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="section-box mb-xs-16 mb-sm-0 flex" *ngIf="!hide.includes('month')"
          [ngStyle]="{'align-items': 'center'}">
          <div class="holiday-container">
            <div class="calendar-header group-btn">
              <div class="holiday-container__btn-group calendar-button">
                <button class="btn-sm date-back" mat-stroked-button (click)="onPrevDate()" #tooltip="matTooltip"
                  matTooltip="ខែមុន" matTooltipPosition="above">
                  <mat-icon>chevron_left</mat-icon>
                </button>

                <button class="date-today" mat-stroked-button mwlCalendarToday (click)="dp.open();">
                  {{ (month.value | date: 'MM' | khmerMonth) + ' ' + (month.value | date: 'yyyy') }}
                  <div class="hidden">
                    <input matInput [matDatepicker]="dp" readonly [formControl]="month">
                    <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                    <mat-datepicker #dp startView="multi-year" (monthSelected)="onMonthChange($event, dp)"
                      panelClass="example-month-picker">
                    </mat-datepicker>
                  </div>
                </button>

                <button class="btn-sm date-forward" mat-stroked-button mwlCalendarNextView (click)="onNextDate()"
                  #tooltip="matTooltip" matTooltip="ខែបន្ទាប់" matTooltipPosition="above">
                  <mat-icon>navigate_next</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="create-btn" *ngIf="hasButton">
    <button *ngIf="button.label" role="button" type="button" (click)="onButtonAction()" mat-raised-button
      color="primary">
      <mat-icon [svgIcon]="button.svgIcon" matPrefix>{{button.matIcon}}</mat-icon>
      {{ button.label }}
    </button>
    <button *ngIf="!button.label" mat-stroked-button color="print" class="btn-sm">
      <mat-icon [svgIcon]="button.svgIcon" matPrefix>{{button.matIcon}}</mat-icon>
    </button>
  </div>

</mat-card>
