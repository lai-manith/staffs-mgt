<div class="app-content">
  <div class="attendance-staff-content">

    <div class="app-title">
      <h1 class="title">ស្រង់វត្តមានបុគ្គលិក</h1>
      <button mat-raised-button color="primary" class="create-btn" [routerLink]="['history']">
        <mat-icon svgIcon="eye_alt"></mat-icon>
        វត្តមានបុគ្គលិកលំអិត
      </button>
    </div>

    <h2>
      វត្តមានបុគ្គលិកសម្រាប់ថ្ងៃ៖
    </h2>
    <mat-card class="mat-elevation-z0 filter-card with-create grid gap-16 col-md-3 bg-grey mb-16 border">
      <div class="search-box">
        <div class="filter-search">
          <app-datepicker [ngStyle]="{'pointer-event': dataSource?.data?.length < 0 ? 'none' : ''}"
            (dateChange)="dateChange($event)"></app-datepicker>
        </div>
      </div>
    </mat-card>

    <div class="table-sticky no-shadow">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 table-custom table-staff">

        <ng-container matColumnDef="name" sticky>
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ឈ្មោះបុគ្គលិក</th>
          <td mat-cell *matCellDef="let element">
            <div class="thumbnail-list" *ngIf="element._id != 'all'">
              <div
                [ngStyle]="{ 'background-image': element?.profile ? 'url(' + (element.profile | staticFile) +')' : 'url(/assets/imgs/profile-default.svg)' }"
                class="profile-picture"></div>
              <div>
                <span class="ml-4">{{element | fullName}}</span>
                <div style="font-size: 12px; color: #00000085;">
                  {{ element.staff_id ? '( អត្តលេខ: ' + element.staff_id + ' )' : '' }}
                </div>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container *ngFor="let c of shiftColumns | slice:1; let i = index; trackBy: trackByIndex"
          [matColumnDef]="c.columnDef">
          <th mat-header-cell *matHeaderCellDef>{{ c.header }}</th>
          <td mat-cell *matCellDef="let element">
            <div *ngIf="attendance.length > 0">
              <div class="attendance-table-header-option" *ngIf="element._id == 'all'">
                <div class="center">
                  <div class="action">
                    <mat-button-toggle-group aria-label="Absent" [value]="getAbsentSubject('all', c.shiftType)">
                      <mat-button-toggle mat-fab class="present" value=1
                        (click)="onAbsentChange(1, 'all', c.shiftType)">
                        <mat-icon>check</mat-icon>
                        មក
                      </mat-button-toggle>
                      <mat-button-toggle class="absent" value=2 (click)="onAbsentChange(2, 'all', c.shiftType)">
                        <mat-icon>close</mat-icon>
                        អវត្តមាន
                      </mat-button-toggle>
                      <mat-button-toggle class="permission" value=3 (click)="onAbsentChange(3, 'all', c.shiftType)">
                        <mat-label>ច</mat-label>
                        ច្បាប់
                      </mat-button-toggle>
                    </mat-button-toggle-group>
                  </div>
                </div>
              </div>

              <div class="action" *ngIf="element._id != 'all'">
                <mat-button-toggle-group aria-label="Absent" [value]="getAbsentSubject(element._id, c.shiftType)">
                  <mat-button-toggle mat-fab class="present" value=1
                    (click)="onAbsentChange(1, element._id, c.shiftType)">
                    <mat-icon *ngIf="getAbsentSubject(element._id, c.shiftType) == '1'">check</mat-icon>
                  </mat-button-toggle>
                  <mat-button-toggle class="absent" value=2 (click)="onAbsentChange(2, element._id, c.shiftType)">
                    <mat-icon *ngIf="getAbsentSubject(element._id, c.shiftType) == '2'">close</mat-icon>
                  </mat-button-toggle>
                  <mat-button-toggle class="permission" value=3 (click)="onAbsentChange(3, element._id, c.shiftType)">
                    <mat-label *ngIf="getAbsentSubject(element._id, c.shiftType) == '3'">ច</mat-label>
                  </mat-button-toggle>
                </mat-button-toggle-group>
              </div>
            </div>
          </td>
        </ng-container>

        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="12">មិនមានទិន្នន័យ</td>
        </tr>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      </table>
    </div>

    <div class="group-btn group-action mt-25" align="right">
      <button mat-raised-button color="primary" class="button-submit" (click)="onSubmit()">
        <mat-icon *ngIf="!isLoading">save</mat-icon>
        <mat-spinner *ngIf="isLoading" [diameter]="25"></mat-spinner>
        រក្សាទុក
      </button>
    </div>
  </div>
</div>
